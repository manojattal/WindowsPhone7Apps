(function(a,c){var b={};a.autocomplete=function(d){this.options=c.extend({input:null,select:null,minLength:1,includeRecents:true,includePWS:false,autosubmit:false,isMainSearchBox:false,zipCodeOnly:false,captureFormSubmit:false,onSelect:c.noop,suffix:c.noop,exclude:[],className:"",url:"",autoFocus:false,data:{}},d?d:{});this.input=c(this.options.input);this.select=c(this.options.select);this.hasSelect=(this.select&&this.select.length>0);this.initialize()};a.autocomplete.prototype.initialize=function(){var d=this.input;var f=this.hasSelect;var e=this.options;if(!d[0]){return}this.input.autocomplete({source:function(i,g){var j=/^\d+$/.test(i.term.substr(0,5));if(e.zipCodeOnly&&!j){g(function(){return false})}else{var h=e.url||a.autocomplete._config.url;c.ajax({url:e.url||a.autocomplete._config.url,dataType:"jsonp",jsonp:"cb",data:c.extend(true,{},{query:i.term,h:"1"},e.data),success:function(n){if(!n||!n.RESULTS){return}var k=[];if(e.includeRecents){var l=a.autocomplete._config.items;var o=new RegExp("^"+c.ui.autocomplete.escapeRegex(i.term),"i");l=c.grep(l,function(p){return o.test(p.name)});k=k.concat(l)}k=k.concat(n.RESULTS);var m=c.map(k,function(s){var p=i.term.length;var q=s.name;var r=s.type;var u;if(!e.includePWS&&r=="pws"){return null}if(c.inArray(r,e.exclude)>=0){return null}if(e.zipCodeOnly){u=q.substr(0,5)}else{if(r=="pws"){u=q.split(",",1)[0]}else{if(r=="recent"){u=q}else{u=q}}}var v=e.suffix(u,s)||"";var t=c.extend(true,{},s,{label:'<span class="ui-autocomplete-term">'+q.substr(0,p)+"</span>"+q.substr(p)+v,value:u});return t});g(m)}})}},search:function(h,i){var g=c(this).autocomplete("option","disabled");if(g){return false}},select:function(g,h){if(h.item){this.value=h.item.zip||h.item.value;if(f){this._updateSelectMenu(h.item.type)}if(e.autosubmit){if(e.autosubmit==="form"){this.form.submit()}else{if(h.item.type=="pws"){window.location="/weatherstation/WXDailyHistory.asp?ID="+this.value.toUpperCase()}else{if(h.item.l){window.location=h.item.l}else{if(e.isMainSearchBox&&h.item.wmo){window.location="/global/stations/"+h.item.wmo+".html"}else{if(e.isMainSearchBox&&window.SubmitFastForecastSearch){window.SubmitFastForecastSearch()}else{this.form.submit()}}}}}}e.onSelect(this.value,h.item)}},minLength:e.minLength,autoFocus:e.autoFocus}).data("autocomplete")._renderMenu=function(i,h){var g=this;var j="";c.each(h,function(l,m){if(m.type!=j){var k=a.autocomplete._config.groupTitles[m.type]||m.type;i.append("<li class='ui-autocomplete-group'>"+k+"</li>");j=m.type}g._renderItem(i,m)})};this.input.data("autocomplete")._renderItem=function(g,h){return c("<li></li>").data("item.autocomplete",h).append(c("<a></a>").html(h.label)).appendTo(g)};this.input.autocomplete("widget").addClass(e.className);if(f){this.select.change(this._updateEnabledState);this._updateEnabledState()}if(e.captureFormSubmit){this.captureFormSubmit()}};a.autocomplete.prototype.captureFormSubmit=function(){var d=this.input;if(!this.input[0]){return}var e=c(this.input[0].form);e.submit(function(f){d.autocomplete("search",d.val());f.preventDefault()})};a.autocomplete.prototype._updateEnabledState=function(){var d=this.select.val().toLowerCase();if(d=="weather"||d=="pws"){this.input.autocomplete("option","disabled",false);a.autocomplete.setNative(this.input,false)}else{this.input.autocomplete("option","disabled",true);a.autocomplete.setNative(this.input,true)}};a.autocomplete.prototype._updateSelectMenu=function(d){if(d=="city"){this.select.val("WEATHER")}else{if(d=="pws"){this.select.val("PWS")}}};a.autocomplete.setNative=function(d,e){if(e===false){d.addClass("ui-autocomplete-input").attr({autocomplete:"off",role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"})}else{if(e===true){d.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup")}}};a.autocomplete._config={items:[],groupTitles:{},url:"http://autocomplete.wunderground.com/aq"};a.autocomplete.addItems=function(d){a.autocomplete._config.items=a.autocomplete._config.items.concat(d)};a.autocomplete.setGroupTitles=function(d){a.autocomplete._config.groupTitles=d};a.autocomplete.setUrl=function(d){a.autocomplete._config.url=d};c(document).ready(function(){var d=new a.autocomplete({input:"#wuSearch",select:"#wuSelect",autosubmit:true,isMainSearchBox:true,includePWS:true,data:{ski:1,features:1}})})})(wui,jQuery);